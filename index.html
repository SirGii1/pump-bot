<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpFun | Telegram Only Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white font-sans">

    <div class="max-w-5xl mx-auto p-6">
        <div class="flex justify-between items-center mb-8 bg-gray-900 p-6 rounded-2xl border border-gray-800 shadow-2xl">
            <div>
                <h1 class="text-2xl font-black text-indigo-400">PUMP.FUN <span class="text-white text-sm bg-blue-600 px-2 py-1 rounded ml-2">TG ONLY</span></h1>
                <p class="text-gray-400 text-xs mt-1">Filtering tokens for community links...</p>
            </div>
            <div id="connectionStatus" class="flex items-center gap-2 px-4 py-2 bg-red-900/20 text-red-500 rounded-full text-xs font-bold border border-red-900/50">
                OFFLINE
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-gray-900 p-4 rounded-xl border border-gray-800 text-center">
                <p class="text-gray-500 text-xs uppercase tracking-widest mb-1">Total Scanned</p>
                <span id="scannedCount" class="text-xl font-bold">0</span>
            </div>
            <div class="bg-gray-900 p-4 rounded-xl border border-gray-800 text-center">
                <p class="text-gray-500 text-xs uppercase tracking-widest mb-1">Telegram Found</p>
                <span id="tgCount" class="text-xl font-bold text-blue-400">0</span>
            </div>
        </div>

        <div id="tokenGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </div>

    <script>
        const BOT_TOKEN = "8579945497:AAG2rxeNscB9mo--d2F1l3dWvwqiUlFuEz8";
        const ADMIN_ID = "8207126990";
        const WS_URL = "wss://pumpportal.fun/api/data";

        let socket;
        let scanned = 0;
        let tgFound = 0;

        function connect() {
            socket = new WebSocket(WS_URL);

            socket.onopen = () => {
                updateStatus(true);
                socket.send(JSON.stringify({ method: "subscribeNewToken" }));
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.mint) {
                    scanned++;
                    document.getElementById('scannedCount').innerText = scanned;

                    // FILTER LOGIC: Only proceed if Telegram exists
                    if (data.telegram && data.telegram.trim() !== "") {
                        tgFound++;
                        document.getElementById('tgCount').innerText = tgFound;
                        
                        displayToken(data);
                        sendTelegram(data);
                    }
                }
            };

            socket.onclose = () => {
                updateStatus(false);
                setTimeout(connect, 3000);
            };
        }

        async function sendTelegram(token) {
            const message = `üì± *NEW TELEGRAM TOKEN*\n\n` +
                `üè∑ *${token.name} (${token.symbol})*\n` +
                `üîó \`${token.mint}\`\n\n` +
                `üí¨ [JOIN TELEGRAM](${token.telegram})\n` +
                `üìà [View on Pump.fun](https://pump.fun/${token.mint})`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
            } catch (err) { console.error("TG Alert Error"); }
        }

        function displayToken(t) {
            const grid = document.getElementById('tokenGrid');
            const card = document.createElement('div');
            card.className = "bg-gray-900 border border-gray-800 p-5 rounded-2xl hover:border-blue-500 transition-all shadow-xl animate-pulse";
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg truncate">${t.name}</h3>
                    <span class="text-blue-400 text-[10px] bg-blue-900/30 px-2 py-1 rounded font-bold uppercase">TG Linked</span>
                </div>
                <p class="text-[10px] font-mono text-gray-500 mb-4 truncate bg-black p-2 rounded">${t.mint}</p>
                <div class="flex gap-2">
                    <a href="${t.telegram}" target="_blank" class="flex-1 text-center py-2 bg-blue-600 hover:bg-blue-500 rounded-xl text-xs font-bold">Join TG</a>
                    <a href="https://pump.fun/${t.mint}" target="_blank" class="flex-1 text-center py-2 bg-gray-800 hover:bg-gray-700 rounded-xl text-xs font-bold">Details</a>
                </div>
            `;
            
            grid.prepend(card);
            setTimeout(() => card.classList.remove('animate-pulse'), 1000);
            if (grid.children.length > 20) grid.removeChild(grid.lastChild);
        }

        function updateStatus(online) {
            const el = document.getElementById('connectionStatus');
            el.innerText = online ? "LIVE MONITORING" : "OFFLINE";
            el.className = online ? "flex items-center gap-2 px-4 py-2 bg-green-900/20 text-green-500 rounded-full text-xs font-bold border border-green-900/50" : "flex items-center gap-2 px-4 py-2 bg-red-900/20 text-red-500 rounded-full text-xs font-bold border border-red-900/50";
        }

        connect();
    </script>
</body>
</html>
